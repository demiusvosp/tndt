{% extends 'base_layout.html.twig' %}
{% import 'task/_macro.html.twig' as mTask %}


{% block title %} {{ task.taskId }} - {{ task.caption }} {% endblock %}
{% block page_title%}{% endblock %}
{% block page_subtitle %}{% endblock %}

{% block page_content %}
    <div class="row">
        <div class="col-md-10">
            {% embed '@AdminLTE/Widgets/box-widget.html.twig' %}
                {% import 'project/_macro.html.twig' as mProject %}
                {% import 'task/_macro.html.twig' as mTask %}
                {% import 'user/_macro.html.twig' as mUser %}

                {% block box_title %}
                    <b>{{ task.taskId }}</b> - {{ task.caption }}
                {% endblock %}
                {% block box_body %}
                    <div class="task-properties">
                        <div class="row">
                            <div class="col-md-4 task-property-item">
                                {{ 'task.project.label'|trans }}: {{ mProject.badge(task.project, true, true) }}
                            </div>
                            <div class="col-md-4 task-property-item">
                                {% if dictionary_enabled(task, 'stage') %}
                                    {{ 'task.stage.label'|trans }}: {{ dictionary_name(task, 'stage') }}
                                {% endif %}
                                {# хз возможно этап сюда, в левее к проекту категорию/Систему #}
                            </div>
                            <div class="col-md-4 task-property-item">
                                {% if dictionary_enabled(task, 'type') %}
                                    {{ 'task.type.label'|trans }}: {{ dictionary_name(task, 'type') }}
                                {% endif %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 task-property-item">
                                {{ 'task.createdBy.label'|trans }}: {{ mUser.badge(task.createdBy, true, true, 'instrumental') }}
                            </div>
                            <div class="col-md-4 task-property-item">
                                {{ 'task.created.label'|trans }}: {{ task.createdAt|ago }}
                            </div>
                            <div class="col-md-4 task-property-item">
                                {% if dictionary_enabled(task, 'priority') %}
                                    {{ 'task.priority.label'|trans }}: {{ dictionary_name(task, 'priority') }}
                                {% endif %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 task-property-item">
                                {{ 'task.assignedTo.label'|trans }}: {{ mUser.badge(task.assignedTo, true, true, 'dative') }}
                            </div>
                            <div class="col-md-4 task-property-item">
                                {{ 'task.updated.label'|trans }}: {{ task.updatedAt|ago }}
                            </div>
                            <div class="col-md-4 task-property-item">
                                {% if dictionary_enabled(task, 'complexity') %}
                                    {{ 'task.complexity.label'|trans }}: {{ dictionary_name(task, 'complexity') }}
                                {% endif %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 task-property-item">

                            </div>
                            <div class="col-md-4 task-property-item">

                            </div>
                            <div class="col-md-4 task-property-item">

                            </div>
                        </div>
                    </div>
                    <hr>
                    <p>
                        {{ task.description|markdown_to_html }}
                    </p>
                {% endblock %}
            {% endembed %}
        </div>
        <div class="col-md-2">
            {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
            {% embed '@AdminLTE/Widgets/box-widget.html.twig' %}
                {% import 'task/_macro.html.twig' as mTask %}
                {% block box_title %}
                    {{ 'ControlPanel'|trans }}
                {% endblock  %}
                {% block box_body %}
                    <form action="{{ controls.stages.action }}" method="post">
                    <div class="btn-group-vertical" role="toolbar" aria-label="{{ 'ControlPanel'|trans }}">
                        {% if controls.edit %}
                            <a class="btn btn-default btn-secondary" href="{{ controls.edit.action }}">{{ 'Edit'|trans }}</a>
                        {% endif %}
                            {% for stage in controls.stages.items %}
                                <button
                                    class="btn btn-default btn-secondary"
                                    type="submit"
                                    name="new_stage"
                                    value="{{ stage.value }}"
                                >
                                    {{ 'task.stage.change_to'|trans ~ ' "' ~ stage.label ~ '"' }}
                                </button>
                            {% endfor %}
                            <input type="hidden" name="_token" value="{{ controls.stages.token }}">
                        {% if controls.close %}
                            <button
                                    class="btn btn-secondary btn-warning confirm-close"
                                    data-action="{{ controls.close.action }}"
                            >
                                {{ 'Close'|trans }}
                            </button>
                        {% endif %}
                    </div>
                    </form>
                    {% if controls.close %}
                        {{ mTask.close_task_modal(task) }}
                    {% endif %}
                {% endblock %}
            {% endembed %}
            {% endif %}
        </div>
    </div>
    <div class="row">
        <div class="col-md-10">
            {% embed '@AdminLTE/Widgets/box-widget.html.twig' %}
            {% block box_title %}
                {{ 'Works.title'|trans }}
            {% endblock %}
            {% block box_body %}
                <ul class="nav nav-tabs">
                    {% set currentTab = app.request.query.get('tab', 'comments') %}
                    <li {% if currentTab == 'comments' %}class="active"{% endif %}>
                        <a href="{{ path('task.index', {'taskId': task.taskId, 'tab': 'comments'}) }}">{{ 'Works.comments'|trans }}</a>
                    </li>
                    <li {% if currentTab == 'activity' %}class="active"{% endif %}>
                        <a href="{{ path('task.index', {'taskId': task.taskId, 'tab': 'activity'}) }}">{{ 'Works.activity'|trans }}</a>
                    </li>
                </ul>
                <div class="one-block-content">
                    {% if currentTab == 'comments' %}
                        {{ comment_widget(task) }}
                    {% elseif currentTab == 'activity' %}
                        <div id="activity-widget">
                            <activity-timeline action="{{ path('activity.list', {'type': 'task', 'id': task.id})}}"></activity-timeline>
                        </div>
                    {% endif %}
                </div>
            {% endblock %}
            {% endembed %}
        </div>
    </div>
{% endblock %}